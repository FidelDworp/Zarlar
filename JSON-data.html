<!DOCTYPE html>
<html>
<head>
    <title>Zarlardinge - Compact Kamer Status</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body{background:url("BG.jpg") center/cover no-repeat;font-family:Arial,sans-serif;margin:0;color:#333}
        .title{font-size:24px;font-weight:bold;text-align:center;padding:20px 0;color:#333}
        .buttons{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;padding:0 10px 20px}
        .btn{padding:12px 20px;background:#007bff;color:white;border:none;border-radius:8px;font-size:15px;cursor:pointer;min-width:100px}
        .status-box{max-width:500px;margin:20px auto;padding:18px;background:rgba(255,255,255,0.96);border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.2)}
        .item{display:flex;justify-content:space-between;align-items:center;margin:5px 0;font-size:13.5px}
        .label{font-weight:bold;color:#1a5276;width:115px}
        .value{font-family:monospace;font-weight:bold;padding:5px 12px;border-radius:6px;min-width:70px;text-align:center}
        .loading{text-align:center;color:#666;padding:40px;font-style:italic}
        .home{display:block;width:130px;margin:30px auto;padding:12px;background:#28a745;color:white;text-align:center;border-radius:8px;text-decoration:none;font-weight:bold}
    </style>
</head>
<body>

<div class="title">Zarlardinge - Compact Kamer Status</div>

<div class="buttons">
    <button class="btn" onclick="load('30002c000547343233323032','BandB')">BandB</button>
    <button class="btn" onclick="load('5600420005504b464d323520','Badkamer')">Badkamer</button>
    <button class="btn" onclick="load('420035000e47343432313031','Inkom')">Inkom</button>
    <button class="btn" onclick="load('310017001647373335333438','Keuken')">Keuken</button>
    <button class="btn" onclick="load('33004f000e504b464d323520','Wasplaats')">Wasplaats</button>
    <button class="btn" onclick="load('210042000b47343432313031','Eetplaats')">Eetplaats</button>
    <button class="btn" onclick="load('410038000547353138383138','Zitplaats')">Zitplaats</button>
</div>

<div id="result" class="status-box">
    <div class="loading">Kies een kamer...</div>
</div>

<a href="index.html" class="home">Home</a>

<script>
const token = 'ba9d9e1ed9f70cc5db24de2db21764a3a3afe28b';

// VOLGORDE EXACT ZOALS IN JOUW TABEL
const order = ["Strength","Quality","FreeMem","Temp1","Temp2","Humi","Dew","DewAlert","Light","Dust","CO2","TSTATon","MOV1","MOV1light","MOV2","MOV2light","BEAMalert","BEAMlight","SUNLight","Night","Bed","R","G","B"];

// JUISTE MAPPING label â†’ JSON-key
const keyMap = {
    "Strength":"g","Quality":"h","FreeMem":"v","Temp1":"w","Temp2":"x",
    "Humi":"d","Dew":"c","DewAlert":"k","Light":"e","Dust":"b","CO2":"a",
    "TSTATon":"l","MOV1":"i","MOV1light":"m","MOV2":"j","MOV2light":"n",
    "BEAMalert":"o","BEAMlight":"p","SUNLight":"f","Night":"q","Bed":"r",
    "R":"s","G":"t","B":"u"
};

// Kleurregels exact zoals origineel
const rules = {
    "Strength":{min:0,max:100,minC:"red",maxC:"green"},
    "Quality":{min:0,max:100,minC:"red",maxC:"green"},
    "FreeMem":{min:0,max:84,minC:"red",maxC:"green"},
    "Temp1":{min:15,max:25,minC:"blue",maxC:"red"},
    "Temp2":{min:15,max:25,minC:"blue",maxC:"red"},
    "Humi":{min:0,max:60,minC:"white",maxC:"blue"},
    "Dew":{special:true},
    "DewAlert":{min:0,max:1,minC:"green",maxC:"red"},
    "Light":{min:0,max:20,minC:"gray",maxC:"yellow"},
    "Dust":{min:0,max:100,minC:"white",maxC:"black"},
    "CO2":{min:0,max:800,minC:"green",maxC:"red"},
    "TSTATon":{min:0,max:1,minC:"white",maxC:"red"},
    "MOV1":{min:0,max:100,minC:"white",maxC:"black"},
    "MOV1light":{min:0,max:1,minC:"white",maxC:"yellow"},
    "MOV2":{min:0,max:100,minC:"white",maxC:"black"},
    "MOV2light":{min:0,max:1,minC:"white",maxC:"yellow"},
    "BEAMalert":{min:0,max:1,minC:"white",maxC:"orange"},
    "BEAMlight":{min:0,max:1,minC:"white",maxC:"yellow"},
    "SUNLight":{min:0,max:5000,minC:"white",maxC:"yellow"},
    "Night":{min:0,max:1,minC:"white",maxC:"black"},
    "Bed":{min:0,max:1,minC:"white",maxC:"purple"},
    "R":{min:0,max:255,minC:"white",maxC:"red"},
    "G":{min:0,max:255,minC:"white",maxC:"green"},
    "B":{min:0,max:255,minC:"white",maxC:"blue"}
};

function getColor(value, label, temp1) {
    if (value === "Onbekend" || value == null) return "#ffffff";
    const r = rules[label];
    if (label === "Dew") {
        const t = parseFloat(temp1);
        const d = parseFloat(value);
        return (t < d) ? "#ff4444" : "#44aa44";
    }
    const ratio = Math.max(0, Math.min(1, (parseFloat(value) - r.min) / (r.max - r.min)));
    const map = {red:[255,0,0],green:[0,255,0],blue:[0,0,255],white:[255,255,255],black:[0,0,0],yellow:[255,255,0],gray:[128,128,128],orange:[255,165,0],purple:[128,0,128]};
    const c1 = map[r.minC], c2 = map[r.maxC];
    const rgb = `rgb(${Math.round(c1[0]+(c2[0]-c1[0])*ratio)}, ${Math.round(c1[1]+(c2[1]-c1[1])*ratio)}, ${Math.round(c1[2]+(c2[2]-c1[2])*ratio)})`;
    const lum = 0.299*parseInt(rgb.match(/\d+/g)[0]) + 0.587*parseInt(rgb.match(/\d+/g)[1]) + 0.114*parseInt(rgb.match(/\d+/g)[2]);
    return {bg: rgb, text: lum < 128 ? "#fff" : "#000"};
}

async function load(id, name) {
    const box = document.getElementById("result");
    box.innerHTML = `<div class="loading">Laden ${name}...</div>`;
    try {
        const res = await fetch(`https://api.particle.io/v1/devices/${id}/JSON_status?access_token=${token}`);
        const data = await res.json();
        const status = JSON.parse(unescape(data.result));
        const temp1 = status.w || "Onbekend";

        let html = `<h2 style="text-align:center;color:#1a5276;margin:0 0 18px 0;font-size:18px">${name} - Compact Status</h2>`;
        
        order.forEach(label => {
            const key = keyMap[label];
            const value = status.hasOwnProperty(key) ? status[key] : "Onbekend";
            const c = getColor(value, label, temp1);
            html += `<div class="item">
                <span class="label">${label}:</span>
                <span class="value" style="background:${c.bg};color:${c.text}">${value}</span>
            </div>`;
        });
        
        box.innerHTML = html;
    } catch(e) {
        box.innerHTML = `<p style="color:red;text-align:center">Fout: ${e.message}</p>`;
    }
}
</script>
</body>
</html>
