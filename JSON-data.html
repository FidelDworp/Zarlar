<!DOCTYPE html>
<html>
<head>
    <title>Zarlardinge - Compact Kamer Status</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {
            background: url("BG.jpg") center/cover no-repeat;
            font-family: Arial, sans-serif;
            color: #333;
            margin: 10px;
        }
        .title {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
            color: #333;
        }
        .subtitle {
            text-align: center;
            font-size: 16px;
            color: #555;
            margin-bottom: 20px;
        }
        .buttons {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 8px;
            margin: 15px 0;
        }
        .btn {
            padding: 10px 16px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            min-width: 110px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .btn:hover {
            background: #0056b3;
        }
        .status-box {
            max-width: 500px;
            margin: 20px auto;
            padding: 15px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 3px 0;
            padding: 3px 6px;
            font-size: 12px;
            border-radius: 3px;
        }
        .label {
            font-weight: bold;
            color: #1a5276;
            min-width: 120px;
            flex: 1;
        }
        .value {
            font-family: monospace;
            font-weight: bold;
            padding: 2px 5px;
            border-radius: 3px;
            min-width: 50px;
            text-align: center;
            flex: 1;
        }
        .loading {
            text-align: center;
            font-size: 16px;
            color: #666;
            padding: 30px;
        }
        .home {
            display: block;
            width: 120px;
            margin: 30px auto;
            padding: 10px;
            background: #28a745;
            color: white;
            text-align: center;
            border-radius: 6px;
            text-decoration: none;
            font-weight: bold;
        }
        .home:hover {
            background: #218838;
        }
    </style>
</head>
<body>

<div class="title">Zarlardinge - Compact Kamer Status</div>
<div class="subtitle">Kies een kamer voor compact overzicht</div>

<div class="buttons">
    <button class="btn" onclick="loadStatus('30002c000547343233323032', 'BandB')">BandB</button>
    <button class="btn" onclick="loadStatus('5600420005504b464d323520', 'Badkamer')">Badkamer</button>
    <button class="btn" onclick="loadStatus('420035000e47343432313031', 'Inkom')">Inkom</button>
    <button class="btn" onclick="loadStatus('310017001647373335333438', 'Keuken')">Keuken</button>
    <button class="btn" onclick="loadStatus('33004f000e504b464d323520', 'Wasplaats')">Wasplaats</button>
    <button class="btn" onclick="loadStatus('210042000b47343432313031', 'Eetplaats')">Eetplaats</button>
    <button class="btn" onclick="loadStatus('410038000547353138383138', 'Zitplaats')">Zitplaats</button>
</div>

<div id="result" class="status-box">
    <p class="loading">Kies een kamer voor compact overzicht...</p>
</div>

<a href="index.html" class="home">Home</a>

<script>
const token = 'ba9d9e1ed9f70cc5db24de2db21764a3a3afe28b';

// Exacte variabelen-volgorde uit Rooms_Overview.html script
const variables = ['v', 'w', 'x', 'g', 'h', 'd', 'c', 'k', 'e', 'b', 'a', 'l', 'i', 'm', 'j', 'n', 'o', 'p', 'f', 'q', 'r', 's', 't', 'u'];

// Exacte labels uit Rooms_Overview.html tabel-headers (op index van variables)
const labels = [
    "FreeMem", "Temp1", "Temp2", "Strength", "Quality", "Humi", "Dew", "DewAlert", "Light", "Dust", "CO2", "TSTATon", "MOV1", "MOV1light", "MOV2", "MOV2light", "BEAMalert", "BEAMlight", "SUNLight", "Night", "Bed", "R", "G", "B"
];

// Exacte columnRules uit Rooms_Overview.html (op index van variables)
const columnRules = [
    { min: 0, max: 84, minColor: 'red', maxColor: 'green' }, // FreeMem (v)
    { min: 15, max: 25, minColor: 'blue', maxColor: 'red' }, // Temp1 (w)
    { min: 15, max: 25, minColor: 'blue', maxColor: 'red' }, // Temp2 (x)
    { min: 0, max: 100, minColor: 'red', maxColor: 'green' }, // Strength (g)
    { min: 0, max: 100, minColor: 'red', maxColor: 'green' }, // Quality (h)
    { min: 0, max: 60, minColor: 'white', maxColor: 'blue' }, // Humi (d)
    { special: true }, // Dew (c)
    { min: 0, max: 1, minColor: 'green', maxColor: 'red' }, // DewAlert (k)
    { min: 0, max: 20, minColor: 'gray', maxColor: 'yellow' }, // Light (e)
    { min: 0, max: 100, minColor: 'white', maxColor: 'black' }, // Dust (b)
    { min: 0, max: 800, minColor: 'green', maxColor: 'red' }, // CO2 (a)
    { min: 0, max: 1, minColor: 'white', maxColor: 'red' }, // TSTATon (l)
    { min: 0, max: 100, minColor: 'white', maxColor: 'black' }, // MOV1 (i)
    { min: 0, max: 1, minColor: 'white', maxColor: 'yellow' }, // MOV1light (m)
    { min: 0, max: 100, minColor: 'white', maxColor: 'black' }, // MOV2 (j)
    { min: 0, max: 1, minColor: 'white', maxColor: 'yellow' }, // MOV2light (n)
    { min: 0, max: 1, minColor: 'white', maxColor: 'orange' }, // BEAMalert (o)
    { min: 0, max: 1, minColor: 'white', maxColor: 'yellow' }, // BEAMlight (p)
    { min: 0, max: 5000, minColor: 'white', maxColor: 'yellow' }, // SUNLight (f)
    { min: 0, max: 1, minColor: 'white', maxColor: 'black' }, // Night (q)
    { min: 0, max: 1, minColor: 'white', maxColor: 'purple' }, // Bed (r)
    { min: 0, max: 255, minColor: 'white', maxColor: 'red' }, // R (s)
    { min: 0, max: 255, minColor: 'white', maxColor: 'green' }, // G (t)
    { min: 0, max: 255, minColor: 'white', maxColor: 'blue' } // B (u)
];

// Exacte interpolateColor uit Rooms_Overview.html
function interpolateColor(value, min, max, minColor, maxColor) {
    if (value === 'Onbekend' || isNaN(parseFloat(value))) return '#ffffff';
    const ratio = Math.min(Math.max((parseFloat(value) - min) / (max - min), 0), 1);
    const colorMap = {
        'red': [255, 0, 0], 'green': [0, 255, 0], 'blue': [0, 0, 255],
        'white': [255, 255, 255], 'black': [0, 0, 0], 'yellow': [255, 255, 0],
        'gray': [128, 128, 128], 'orange': [255, 165, 0], 'purple': [128, 0, 128]
    };
    const c1 = colorMap[minColor] || [255, 255, 255];
    const c2 = colorMap[maxColor] || [255, 255, 255];
    const r = Math.round(c1[0] + (c2[0] - c1[0]) * ratio);
    const g = Math.round(c1[1] + (c2[1] - c1[1]) * ratio);
    const b = Math.round(c1[2] + (c2[2] - c1[2]) * ratio);
    return `rgb(${r}, ${g}, ${b})`;
}

async function loadStatus(deviceId, locationName) {
    const resultDiv = document.getElementById('result');
    resultDiv.innerHTML = `<p class="loading">Laden status voor <strong>${locationName}</strong>...</p>`;

    try {
        const response = await fetch(`https://api.particle.io/v1/devices/${deviceId}/JSON_status?access_token=${token}`);
        const data = await response.json();
        if (!data.result) throw new Error("Geen data ontvangen");

        const jsonString = unescape(data.result);
        const status = JSON.parse(jsonString);

        let html = `<h2 style="text-align:center;color:#1a5276;margin-bottom:10px">${locationName} - Compact Status</h2>`;

        const temp1Value = status.w !== undefined ? status.w : 'Onbekend';

        variables.forEach((key, index) => {
            if (status.hasOwnProperty(key)) {
                const niceName = labels[index];
                const value = status[key];
                const rule = columnRules[index];

                let bgColor = '#ffffff';
                if (niceName === 'Dew') {
                    if (temp1Value === 'Onbekend' || value === 'Onbekend') {
                        bgColor = '#ffffff';
                    } else {
                        bgColor = parseFloat(temp1Value) < parseFloat(value) ? '#ff4444' : '#44aa44';
                    }
                } else if (rule && !rule.special) {
                    bgColor = interpolateColor(value, rule.min, rule.max, rule.minColor, rule.maxColor);
                }

                // Exacte luminance uit jouw script voor tekstkleur
                const luminance = bgColor.match(/\d+/g) ? (0.299 * parseInt(bgColor.match(/\d+/g)[0]) + 0.587 * parseInt(bgColor.match(/\d+/g)[1]) + 0.114 * parseInt(bgColor.match(/\d+/g)[2])) : 255;
                const textColor = luminance < 128 ? '#ffffff' : '#333';

                html += `<div class="item">
                    <span class="label">${niceName}:</span>
                    <span class="value" style="background-color: ${bgColor}; color: ${textColor};">${value}</span>
                </div>`;
            }
        });

        resultDiv.innerHTML = html;

    } catch (err) {
        resultDiv.innerHTML = `<p style="color:red;text-align:center">Fout bij ${locationName}<br><small>${err.message}</small></p>`;
        console.error(err);
    }
}
</script>

</body>
</html>
