<!DOCTYPE html>
<html>
<head>
    <title>Zarlardinge - Kamer Status met Kleuren</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {
            background: url("BG.jpg") center/cover no-repeat;
            font-family: Arial, sans-serif;
            color: #333;
            margin: 20px;
        }
        .title {
            font-size: 28px;
            font-weight: bold;
            text-align: center;
            margin: 30px 0 10px;
            color: #333;
        }
        .subtitle {
            text-align: center;
            font-size: 18px;
            color: #555;
            margin-bottom: 30px;
        }
        .buttons {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 12px;
            margin: 20px 0;
        }
        .btn {
            padding: 14px 22px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            min-width: 130px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transition: all 0.2s;
        }
        .btn:hover {
            background: #0056b3;
            transform: translateY(-3px);
        }
        .status-box {
            max-width: 600px;
            margin: 30px auto;
            padding: 25px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.18);
        }
        .item {
            margin: 14px 0;
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
            /* Geen blauwe rand meer â€“ verwijderd! */
        }
        .label {
            font-weight: bold;
            color: #1a5276;
            min-width: 220px;
        }
        .value {
            font-family: monospace;
            font-weight: bold;
            padding: 6px 12px;
            border-radius: 8px;
            min-width: 80px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .loading {
            text-align: center;
            font-size: 18px;
            color: #666;
            font-style: italic;
            padding: 40px;
        }
        .home {
            display: block;
            width: 160px;
            margin: 40px auto;
            padding: 14px;
            background: #28a745;
            color: white;
            text-align: center;
            border-radius: 10px;
            text-decoration: none;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .home:hover {
            background: #218838;
        }
    </style>
</head>
<body>

<div class="title">Zarlardinge - Live Kamerstatus</div>
<div class="subtitle">Kies een ruimte voor gedetailleerde status met kleuren</div>

<div class="buttons">
    <button class="btn" onclick="loadStatus('30002c000547343233323032', 'BandB')">BandB</button>
    <button class="btn" onclick="loadStatus('5600420005504b464d323520', 'Badkamer')">Badkamer</button>
    <button class="btn" onclick="loadStatus('420035000e47343432313031', 'Inkom')">Inkom</button>
    <button class="btn" onclick="loadStatus('310017001647373335333438', 'Keuken')">Keuken</button>
    <button class="btn" onclick="loadStatus('33004f000e504b464d323520', 'Wasplaats')">Wasplaats</button>
    <button class="btn" onclick="loadStatus('210042000b47343432313031', 'Eetplaats')">Eetplaats</button>
    <button class="btn" onclick="loadStatus('410038000547353138383138', 'Zitplaats')">Zitplaats</button>
</div>

<div id="result" class="status-box">
    <p class="loading">Kies een kamer om de live status met kleuren te zien...</p>
</div>

<a href="index.html" class="home">Home</a>

<script>
const token = 'ba9d9e1ed9f70cc5db24de2db21764a3a3afe28b';

// Labels exact zoals in Rooms_Overview.html headers (geen (Red) etc.)
const labels = {
    g: "Strength",     h: "Quality",      v: "FreeMem",      w: "Temp1",
    x: "Temp2",        d: "Humi",         c: "Dew",          k: "DewAlert",
    e: "Light",        b: "Dust",         a: "CO2",          l: "TSTATon",
    i: "MOV1",         m: "MOV1light",    j: "MOV2",         n: "MOV2light",
    o: "BEAMalert",    p: "BEAMlight",    f: "SUNLight",     q: "Night",
    r: "Bed",          s: "R",            t: "G",            u: "B"
};

// Volgorde exact zoals in Rooms_Overview.html tabel-kolommen (vanaf Strength)
const order = ['g', 'h', 'v', 'w', 'x', 'd', 'c', 'k', 'e', 'b', 'a', 'l', 'i', 'm', 'j', 'n', 'o', 'p', 'f', 'q', 'r', 's', 't', 'u'];

// Exacte kleurregels uit Rooms_Overview.html
const columnRules = {
    'Strength': { min: 0, max: 100, minColor: 'red', maxColor: 'green' },
    'Quality': { min: 0, max: 100, minColor: 'red', maxColor: 'green' },
    'FreeMem': { min: 0, max: 84, minColor: 'red', maxColor: 'green' },
    'Temp1': { min: 15, max: 25, minColor: 'blue', maxColor: 'red' },
    'Temp2': { min: 15, max: 25, minColor: 'blue', maxColor: 'red' },
    'Humi': { min: 0, max: 60, minColor: 'white', maxColor: 'blue' },
    'Dew': { special: true },
    'DewAlert': { min: 0, max: 1, minColor: 'green', maxColor: 'red' },
    'Light': { min: 0, max: 20, minColor: 'gray', maxColor: 'yellow' },
    'Dust': { min: 0, max: 100, minColor: 'white', maxColor: 'black' },
    'CO2': { min: 0, max: 800, minColor: 'green', maxColor: 'red' },
    'TSTATon': { min: 0, max: 1, minColor: 'white', maxColor: 'red' },
    'MOV1': { min: 0, max: 100, minColor: 'white', maxColor: 'black' },
    'MOV1light': { min: 0, max: 1, minColor: 'white', maxColor: 'yellow' },
    'MOV2': { min: 0, max: 100, minColor: 'white', maxColor: 'black' },
    'MOV2light': { min: 0, max: 1, minColor: 'white', maxColor: 'yellow' },
    'BEAMalert': { min: 0, max: 1, minColor: 'white', maxColor: 'orange' },
    'BEAMlight': { min: 0, max: 1, minColor: 'white', maxColor: 'yellow' },
    'SUNLight': { min: 0, max: 5000, minColor: 'white', maxColor: 'yellow' },
    'Night': { min: 0, max: 1, minColor: 'white', maxColor: 'black' },
    'Bed': { min: 0, max: 1, minColor: 'white', maxColor: 'purple' },
    'R': { min: 0, max: 255, minColor: 'white', maxColor: 'red' },
    'G': { min: 0, max: 255, minColor: 'white', maxColor: 'green' },
    'B': { min: 0, max: 255, minColor: 'white', maxColor: 'blue' }
};

// Exacte interpolateColor uit jouw script
function interpolateColor(value, min, max, minColor, maxColor) {
    if (value === 'Onbekend' || isNaN(parseFloat(value))) return '#ffffff';
    const ratio = Math.min(Math.max((parseFloat(value) - min) / (max - min), 0), 1);
    const colorMap = {
        'red': [255, 0, 0], 'green': [0, 255, 0], 'blue': [0, 0, 255],
        'white': [255, 255, 255], 'black': [0, 0, 0], 'yellow': [255, 255, 0],
        'gray': [128, 128, 128], 'orange': [255, 165, 0], 'purple': [128, 0, 128]
    };
    const c1 = colorMap[minColor] || [255, 255, 255];
    const c2 = colorMap[maxColor] || [255, 255, 255];
    const r = Math.round(c1[0] + (c2[0] - c1[0]) * ratio);
    const g = Math.round(c1[1] + (c2[1] - c1[1]) * ratio);
    const b = Math.round(c1[2] + (c2[2] - c1[2]) * ratio);
    return `rgb(${r}, ${g}, ${b})`;
}

async function loadStatus(deviceId, locationName) {
    const resultDiv = document.getElementById('result');
    resultDiv.innerHTML = `<p class="loading">Laden status voor <strong>${locationName}</strong>...</p>`;

    try {
        const response = await fetch(`https://api.particle.io/v1/devices/${deviceId}/JSON_status?access_token=${token}`);
        const data = await response.json();
        if (!data.result) throw new Error("Geen data ontvangen");

        const jsonString = unescape(data.result);
        const status = JSON.parse(jsonString);

        let html = `<h2 style="text-align:center;color:#1a5276;margin-bottom:25px">${locationName} - Live Status</h2>`;

        const temp1Value = status.w !== undefined ? status.w : 'Onbekend'; // Voor Dew-vergelijking

        order.forEach(key => {
            if (status.hasOwnProperty(key)) {
                const niceName = labels[key];
                const value = status[key];
                const columnName = niceName; // Voor colorRules
                const rule = columnRules[columnName];

                let bgColor = '#ffffff';
                if (columnName === 'Dew') {
                    // Speciale regel uit jouw script: rood als Temp1 < Dew
                    if (temp1Value === 'Onbekend' || value === 'Onbekend') {
                        bgColor = '#ffffff';
                    } else {
                        bgColor = parseFloat(temp1Value) < parseFloat(value) ? '#ff4444' : '#44aa44';
                    }
                } else if (rule) {
                    bgColor = interpolateColor(value, rule.min, rule.max, rule.minColor, rule.maxColor);
                }

                // Tekst kleur aanpassen voor leesbaarheid (uit jouw script)
                const luminance = bgColor.match(/\d+/g) ? (0.299 * parseInt(bgColor.match(/\d+/g)[0]) + 0.587 * parseInt(bgColor.match(/\d+/g)[1]) + 0.114 * parseInt(bgColor.match(/\d+/g)[2])) : 255;
                const textColor = luminance < 128 ? '#ffffff' : '#333';

                html += `<div class="item">
                    <span class="label">${niceName}:</span>
                    <span class="value" style="background-color: ${bgColor}; color: ${textColor};">${value}</span>
                </div>`;
            }
        });

        resultDiv.innerHTML = html;

    } catch (err) {
        resultDiv.innerHTML = `<p style="color:red;text-align:center">Fout bij ophalen ${locationName}<br><small>${err.message}</small></p>`;
        console.error(err);
    }
}
</script>

</body>
</html>
