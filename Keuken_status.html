<!DOCTYPE html>
<html>
<head>
    <title>Zarlardinge Schuur - Keuken Status</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {
            background-image: url("BG.jpg");
            background-size: cover;
            background-repeat: no-repeat;
            font-family: Arial, sans-serif;
            color: #333;
        }
        h1 {
            font-size: 18px;
            margin: 20px 0 10px 20px;
        }
        #status {
            margin: 20px;
            padding: 15px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            max-width: 300px;
        }
        .status-item {
            margin: 5px 0;
            font-size: 14px;
        }
        .label {
            font-weight: bold;
            margin-right: 5px;
        }
    </style>
</head>
<body>
    <h1>Status - R4-KEUK</h1>
    <div id="status">
        <p class="status-item"><span class="label">a</span>= <span id="status-a">Laden…</span></p>
        <p class="status-item"><span class="label">b</span>= <span id="status-b">Laden…</span></p>
        <p class="status-item"><span class="label">c</span>= <span id="status-c">Laden…</span></p>
        <p class="status-item"><span class="label">d</span>= <span id="status-d">Laden…</span></p>
        <p class="status-item"><span class="label">e</span>= <span id="status-e">Laden…</span></p>
        <p class="status-item"><span class="label">f</span>= <span id="status-f">Laden…</span></p>
        <p class="status-item"><span class="label">g</span>= <span id="status-g">Laden…</span></p>
        <p class="status-item"><span class="label">h</span>= <span id="status-h">Laden…</span></p>
        <p class="status-item"><span class="label">i</span>= <span id="status-i">Laden…</span></p>
        <p class="status-item"><span class="label">j</span>= <span id="status-j">Laden…</span></p>
        <p class="status-item"><span class="label">k</span>= <span id="status-k">Laden…</span></p>
        <p class="status-item"><span class="label">l</span>= <span id="status-l">Laden…</span></p>
        <p class="status-item"><span class="label">m</span>= <span id="status-m">Laden…</span></p>
        <p class="status-item"><span class="label">n</span>= <span id="status-n">Laden…</span></p>
        <p class="status-item"><span class="label">o</span>= <span id="status-o">Laden…</span></p>
        <p class="status-item"><span class="label">p</span>= <span id="status-p">Laden…</span></p>
        <p class="status-item"><span class="label">q</span>= <span id="status-q">Laden…</span></p>
        <p class="status-item"><span class="label">r</span>= <span id="status-r">Laden…</span></p>
        <p class="status-item"><span class="label">s</span>= <span id="status-s">Laden…</span></p>
        <p class="status-item"><span class="label">t</span>= <span id="status-t">Laden…</span></p>
        <p class="status-item"><span class="label">u</span>= <span id="status-u">Laden…</span></p>
        <p class="status-item"><span class="label">v</span>= <span id="status-v">Laden…</span></p>
        <p class="status-item"><span class="label">w</span>= <span id="status-w">Laden…</span></p>
        <p class="status-item"><span class="label">x</span>= <span id="status-x">Laden…</span></p>
    </div>

<script>
// ==== TOKEN VEILIG OPHALEN VAN JE WORKER ====
let PARTICLE_TOKEN = null;
async function getToken() {
    if (PARTICLE_TOKEN) return PARTICLE_TOKEN;
    try {
        const res = await fetch('https://controllers-diagnose.filip-delannoy.workers.dev/token');
        const data = await res.json();
        PARTICLE_TOKEN = data.token;
        return PARTICLE_TOKEN;
    } catch (e) {
        console.error("Kon token niet ophalen!", e);
        document.querySelectorAll('#status span[id]').forEach(el => el.textContent = "Token fout");
        return null;
    }
}

const deviceId = '310017001647373335333438'; // R4-KEUK

function updateStatus(data) {
    "abcdefghijklmnopqrstuvwxyzx".split('').forEach(letter => {
        const el = document.getElementById(`status-${letter}`);
        if (el) {
            el.textContent = data[letter] !== undefined ? data[letter] : 'Onbekend';
        }
    });
}

async function fetchStatus() {
    const token = await getToken();
    if (!token) return;

    try {
        const resp = await fetch(`https://api.particle.io/v1/devices/${deviceId}/JSON_status?access_token=${token}`);
        if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
        const json = await resp.json();
        
        let result = json.result || json.body?.result;
        if (!result) throw new Error("Geen result veld");

        // Particle geeft soms een string, soms al een object
        const data = typeof result === "string" ? JSON.parse(result) : result;
        updateStatus(data);

    } catch (err) {
        console.error("Fout bij ophalen keuken status:", err);
        document.querySelectorAll('#status span[id]').forEach(el => el.textContent = "Fout");
    }
}

// Start direct en ververs elke 5 seconden
fetchStatus();
setInterval(fetchStatus, 5000);
</script>
</body>
</html>
