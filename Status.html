<!DOCTYPE html>
<html>
<head>
    <title>Zarlardinge - Live Status</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <style>
    body{
        background:url("BG.jpg") center/cover no-repeat;
        font-family:Arial;
        color:#333;
        margin:20px;
    }
    .title{
        font-size:24px;
        font-weight:bold;
        text-align:center;
        margin-bottom:20px;
        color:#333;
    }
    .section{
        background:rgba(128,128,128,0.5);
        padding:15px;
        border-radius:10px;
        margin-bottom:20px;
        max-height:300px;
        overflow-y:auto;
    }
    h1{
        font-size:18px;
        color:#333;
        margin:0 0 10px;
    }
    .event{
        background:rgba(255,255,255,0.9);
        color:#333;
        padding:8px;
        margin:4px 0;
        border-radius:5px;
        font:12px monospace;
    }
    .time{ color:#666;margin-right:8px; }
    .name{ color:#007bff;font-weight:bold; }
    .home{
        padding:12px 24px;
        background:#007bff;
        color:white;
        border-radius:5px;
        text-decoration:none;
    }
    .home:hover{ background:#0056b3; }
    .status{
        text-align:center;
        padding:10px;
        background:rgba(0,120,0,0.9);
        color:white;
        border-radius:5px;
        font-weight:bold;
    }
    </style>
</head>
<body>

<div class="title">Zarlardinge - Live Status Monitor</div>

<div class="section"><h1>Zitplaats</h1><div id="zitplaats"></div></div>
<div class="section"><h1>BandB</h1><div id="bandb"></div></div>
<div class="section"><h1>Badkamer</h1><div id="badkamer"></div></div>
<div class="section"><h1>Inkom</h1><div id="inkom"></div></div>
<div class="section"><h1>Keuken</h1><div id="keuken"></div></div>
<div class="section"><h1>Wasplaats</h1><div id="wasplaats"></div></div>
<div class="section"><h1>Eetplaats / Slaapkamer</h1><div id="eetplaats"></div></div>
<div class="section"><h1>Buitenverlichting</h1><div id="buiten"></div></div>
<div class="section"><h1>Sunlight</h1><div id="sunlight"></div></div>
<div class="section"><h1>HVAC</h1><div id="hvac"></div></div>
<div class="section"><h1>ECO Solar</h1><div id="solar"></div></div>

<div style="text-align:center;margin:30px 0">
    <a href="index.html" class="home">Home</a>
</div>

<div class="status" id="status">Verbonden – events komen live binnen!</div>

<script>
// ---- CONFIG ---------------------------------------------------------

const token = 'ba9d9e1ed9f70cc5db24de2db21764a3a3afe28b';

// Photon core-ID → DOM-zone
const map = {
    '410038000547353138383138':'zitplaats',
    '30002c000547343233323032':'bandb',
    '5600420005504b464d323520':'badkamer',
    '420035000e47343432313031':'inkom',
    '310017001647373335333438':'keuken',
    '33004f000e504b464d323520':'wasplaats',
    '210042000b47343432313031':'eetplaats',
    '2d0032001247333438353733':'buiten',
    '390028001147343339383037':'sunlight',
    '3e003f001447343338333633':'hvac',
    '310049000f47343432313031':'solar'
};

// ---- EVENT SOURCE ---------------------------------------------------

const statusDiv = document.getElementById("status");

// juiste stream:
const es = new EventSource("https://api.particle.io/v1/devices/events?access_token=" + token);

// Verbonden
es.onopen = () => {
    statusDiv.textContent = "Verbonden – events komen live binnen!";
    statusDiv.style.background = "rgba(0,120,0,0.9)";
};

// Fout → herconnectie
es.onerror = () => {
    statusDiv.textContent = "Verbinding verbroken – opnieuw verbinden...";
    statusDiv.style.background = "rgba(200,50,0,0.9)";
};

// ---- EVENT VERWERKING -----------------------------------------------

es.addEventListener("message", function(e) {
    let payload;
    try {
        payload = JSON.parse(e.data);
    } catch {
        return;
    }

    const coreid = payload.coreid;
    if (!coreid) return;

    const zoneId = map[coreid];
    if (!zoneId) return;

    const zone = document.getElementById(zoneId);
    if (!zone) return;

    const eventName = payload.event || "Onbekend";
    const text = payload.data || "";
    const t = new Date(payload.published_at)
                .toLocaleTimeString('nl-BE', { hour:'2-digit', minute:'2-digit', second:'2-digit' });

    const div = document.createElement("div");
    div.className = "event";
    div.innerHTML = `
        <span class="time">${t}</span>
        <span class="name">${eventName}</span>:
        ${text}
    `;

    zone.insertBefore(div, zone.firstChild);
    if (zone.children.length > 20)
        zone.removeChild(zone.lastChild);
});
</script>

</body>
</html>
