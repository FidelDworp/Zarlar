<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zarlardinge - Live Status</title>
<style>
body {
    font-family: Arial;
    color: #333;
    margin: 20px;
    background: url("BG.jpg") center/cover no-repeat;
}
.title {
    font-size: 24px;
    font-weight: bold;
    text-align: center;
    margin-bottom: 20px;
}
.section {
    background: rgba(128,128,128,0.3);
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 20px;
    max-height: 300px;
    overflow-y: auto;
}
h1 {
    font-size: 18px;
    margin: 0 0 10px;
}
.event {
    background: rgba(255,255,255,0.9);
    color: #333;
    padding: 8px;
    margin: 4px 0;
    border-radius: 5px;
    font: 12px monospace;
}
</style>
</head>
<body>

<div class="title">Zarlardinge - Live Status Monitor</div>

<div class="section"><h1>Zitplaats</h1><div id="zitplaats"></div></div>
<div class="section"><h1>BandB</h1><div id="bandb"></div></div>
<div class="section"><h1>Badkamer</h1><div id="badkamer"></div></div>
<div class="section"><h1>Inkom</h1><div id="inkom"></div></div>
<div class="section"><h1>Keuken</h1><div id="keuken"></div></div>
<div class="section"><h1>Wasplaats</h1><div id="wasplaats"></div></div>
<div class="section"><h1>Eetplaats / Slaapkamer</h1><div id="eetplaats"></div></div>
<div class="section"><h1>Buitenverlichting</h1><div id="buiten"></div></div>
<div class="section"><h1>Sunlight</h1><div id="sunlight"></div></div>
<div class="section"><h1>HVAC</h1><div id="hvac"></div></div>
<div class="section"><h1>ECO Solar</h1><div id="solar"></div></div>

<script>
const token = 'ba9d9e1ed9f70cc5db24de2db21764a3a3afe28b';
const map = {
    '410038000547353138383138':'zitplaats',
    '30002c000547343233323032':'bandb',
    '5600420005504b464d323520':'badkamer',
    '420035000e47343432313031':'inkom',
    '310017001647373335333438':'keuken',
    '33004f000e504b464d323520':'wasplaats',
    '210042000b47343432313031':'eetplaats',
    '2d0032001247333438353733':'buiten',
    '390028001147343339383037':'sunlight',
    '3e003f001447343338333633':'hvac',
    '310049000f47343432313031':'solar'
};

// Houd de laatste 20 berichten per controller
const logs = {};
Object.keys(map).forEach(id => logs[id] = []);

// Polling functie
async function pollEvents() {
    try {
        const resp = await fetch(`https://api.particle.io/v1/events?access_token=${token}&limit=50`);
        const data = await resp.json();
        if (!data || !data.events) return;

        data.events.forEach(evt => {
            const coreid = evt.coreid;
            const msg = evt.data;
            const zone = map[coreid];
            if(!zone) return;

            // update logs
            logs[coreid].unshift(msg);
            if(logs[coreid].length > 20) logs[coreid].pop();

            // update DOM
            const div = document.getElementById(zone);
            div.innerHTML = logs[coreid].map(m => `<div class="event">${m}</div>`).join('');
        });

    } catch(e) {
        console.error('Polling fout:', e);
    }
}

// Start polling elke 2 seconden
pollEvents();
setInterval(pollEvents, 2000);
</script>

</body>
</html>
